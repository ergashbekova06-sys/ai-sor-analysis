import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import io

st.set_page_config(page_title="–ò–ò –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –°–û–†/–°–û–ß", layout="wide")
st.title("üìä –ò–ò-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –°–û–†/–°–û–ß")
st.write("–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel-—Ñ–∞–π–ª –∏–∑ –ö—É–Ω–¥–µ–ª–∏–∫–∞. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã –∏ —Å–æ–∑–¥–∞—Å—Ç –∞–Ω–∞–ª–∏–∑.")

uploaded_file = st.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel —Ñ–∞–π–ª", type=["xlsx", "xls", "csv"])

if uploaded_file:
    df = pd.read_excel(uploaded_file) if uploaded_file.name.endswith("xlsx") else pd.read_csv(uploaded_file)

    st.subheader("üìÑ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞")
    st.dataframe(df)

    st.subheader("üìä –î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤")
    if "–ë–∞–ª–ª—ã" in df.columns:
        fig, ax = plt.subplots()
        ax.hist(df["–ë–∞–ª–ª—ã"], bins=10)
        ax.set_xlabel("–ë–∞–ª–ª—ã")
        ax.set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—â–∏—Ö—Å—è")
        st.pyplot(fig)
    else:
        st.warning("–í —Ç–∞–±–ª–∏—Ü–µ –Ω–µ –Ω–∞–π–¥–µ–Ω —Å—Ç–æ–ª–±–µ—Ü '–ë–∞–ª–ª—ã'.")

    st.subheader("üìà –ü—Ä–æ—Ü–µ–Ω—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –∑–Ω–∞–Ω–∏–π")
    if "–û—Ü–µ–Ω–∫–∞" in df.columns:
        quality = (df["–û—Ü–µ–Ω–∫–∞"] >= 4).sum() / len(df) * 100
        st.write(f"–ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π: **{quality:.1f}%**")
    else:
        st.warning("–ù–µ –Ω–∞–π–¥–µ–Ω —Å—Ç–æ–ª–±–µ—Ü '–û—Ü–µ–Ω–∫–∞'.")

    st.subheader("üß† –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (–ò–ò)")
    analysis_text = f"""
    –í –∫–ª–∞—Å—Å–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤, –æ—Ç—Ä–∞–∂—ë–Ω–Ω–æ–µ –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ –≤—ã—à–µ. 
    –ö–∞—á–µ—Å—Ç–≤–æ –∑–Ω–∞–Ω–∏–π —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ {quality:.1f}%. 

    –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
    ‚Ä¢ —É—Å–∏–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å —É—á–∞—â–∏–º–∏—Å—è, –Ω–∞–±—Ä–∞–≤—à–∏–º–∏ –Ω–∏–∑–∫–∏–µ –±–∞–ª–ª—ã;
    ‚Ä¢ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã;
    ‚Ä¢ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏.
    """
    st.write(analysis_text)

st.write("---")
st.write("–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ò–ò –≤ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ")
